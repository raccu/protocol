\section{Login}
In this section we define a flow for logging in at an independent endpoint using an Auth
issued attestation, as well as the process of authenticating the user by the Auth. 

    \subsection{Flow}
    The login flow is defined as follows:
        \begin{enumerate}
            \item A user MAY try to access an unauthorized resource.
            \item Server MUST notify the user that he/she needs to authenticate and SHALL refer the Auth provider 
                  he/she can use to do so.
            \item Upon receiving the Auth information, the Web MUST fetch an authentication challenge from the
                  the Auth. It is REQUIRED for the challenge to be combined with the domain name and displayed
                  as a QR code for the user to scan it with the Mobile.
            \item When the user scans an aforementioned QR code with the Mobile, the Mobile MUST authenticate the 
                  user locally by using a built-in biometry. Upon authenticating, the Mobile will sign the 
                  challenge, domain name, and user's email. Afterwards, the Mobile MUST send those parameters 
                  alongside the signature to the Auth.
            \item Auth SHOULD notify the Web that the authentication is successful and that the attestation is ready.
            \item Web MUST request the attestation from the Auth by providing a challenge that the Auth issued as a 
                  reference to the authentication session.
            \item Web MUST submit the attestation to the Server as a proof of user's identity, and thus finishing the
                  authentication flow.
        \end{enumerate}

    The flow is shown in a following sequence diagram: 
        \input{diagrams/sequence/login.tex}
    
    \subsection{Token}
    \lipsum[1]
        \begin{figure}[H]
            \centering
            \begin{tikzpicture}
                \begin{class}[fill=white, drop shadow, draw=black]{Auth provider token}{0 ,0}
                    \attribute{user-email : string}
                    \attribute{user-name : string}
                    \attribute{issued-at : timestamp}
                    \attribute{target-domain : string}
                    \attribute{issuer : string}
                    \attribute{signature : hex}
                \end{class}
            \end{tikzpicture}
            \caption{Fields included into authentication token}
        \end{figure}
