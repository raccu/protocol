\section{Reset credentials}
In this section a flow for resetting credentials in case a user looses his/hers
smartphone or no longer has access to it is defined. 

    \subsection{Flow}
    The reset credentials flow is given in Figure~\ref{fig:resetCredentials} and defined as follows:
        \begin{enumerate}
            \item Mobile MUST request a verification code from the Auth by submitting the email address of the user
                  which is seeking a credentials reset.
            \item Upon receiving a reset credentials request, the Auth MUST dispatch an email with the verification
                  code to the Email.
            \item When the user enters verification code into the Mobile, the Mobile MUST provide a method to generate,
                  store, and retrieve public key and an interface for signing an arbitrary message with the matching 
                  private key.
            \item Mobile MUST send user's email, newly generated public key, and the signature of those two parameters
                  and a REQUIRED addition of the verification code to the Auth.
            \item Auth MUST return the user's name to the Mobile to finish the credentials reset.
        \end{enumerate}
        \input{diagrams/sequence/reset-credentials.tex}

    \subsection{Requirements}
    The following requirements are made for a credentials reset:
    \begin{enumerate}
            \item Provided email MUST be associated with an account on Auth.\\
            \textit{Argument:} It is trivial that the Auth cannot reset credentials for a user it does not have any 
                               record of. 

            \item Verification code MUST be at least six characters long, contain a character space of at least ten 
                  characters, and be short lived while it MUST NOT be predictable.\\        
            \textit{Argument:} Verification code should posses a certain entropy and a level of randomness, 
                               just as well as a limited lifetime in order to reduce the likelihood of a 
                               successful brute-force attack.

            \item Verification code MUST NOT be revealed to third parties or sent over the network, except when
                  it's sent to the Email by Auth.\\        
            \textit{Argument:} Verification code represents a shared secret between the entities and revealing 
                               it to other parties or sending it over a (potentially insecure) network poses 
                               a confidentiality breach risk. 

            \item Verification code MUST be reset after a several unsuccessful verification code entries.\\        
            \textit{Argument:} This is to reduce a chance of a successful brute-force attack.

            \item Mobile MUST NOT expose private key directly.\\
            \textit{Argument:} Since the digital signature is a basis of authentication, an utmost respect to 
                               protecting the confidentiality of the private key should be implemented.

            \item Mobile MUST always require a biometric authentication to allow access to digital signing 
                  capability.\\        
            \textit{Argument:} This is to avoid phishing attacks or other illegal attempts to get the user's 
                               digital signature without his/hers explicit approval.

            \item Mobile MUST store generated keys in a trusted execution environment (TEE).\\        
            \textit{Argument:} This is to avoid a root attack or other system-level attacks that target storage 
                               memory or execution environment.

            \item The communication between the Mobile and Auth MUST rely on a secure channel that provides 
                  confidentiality and verifies integrity. It is RECOMMENDED to use up-to-date version of 
                  TLS protocol with a well-tested and computationally secure cipher suite.\\      
            \textit{Argument:} Mobile and Auth exchange user's personal information and transmitting them over a 
                               public channel would pose a privacy concern, as well as create new vectors of attack, 
                               namely social engineering, phishing, and targeted brute-force attacks.
    \end{enumerate}
