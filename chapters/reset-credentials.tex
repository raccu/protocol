\section{Reset credentials}
In this section, a flow for resetting credentials in case a user loses their smartphone, they no longer have access to it,
or they wish to reset credentials for any other reason is defined.

    \subsection{Flow}
    The reset credentials flow is given in Figure~\ref{fig:resetCredentials} on page~\pageref{fig:resetCredentials} 
    and is defined as follows:
        \begin{enumerate}
            \item Mobile MUST request a verification code from the Auth by submitting the email address of the user
                  which is seeking a credentials reset.
            \item Upon receiving a reset credentials request, the Auth MUST dispatch an email with the verification
                  code to the Email.
            \item When the user enters verification code into the Mobile, the Mobile MUST provide a method to generate,
                  store, and retrieve public key and an interface for signing an arbitrary message with the matching 
                  private key.
            \item Mobile MUST authenticate the user locally using a built-in biometry. Upon authenticating, Mobile 
                  MUST send user's email, newly generated public key, and a digital signature of all of the previous 
                  parameters, with a REQUIRED addition of the verification code, to the Auth.
            \item Auth MUST return the user's name to the Mobile to finish the credentials reset.
        \end{enumerate}
        \input{diagrams/sequence/reset-credentials.tex}

    \subsection{Successful credentials reset}
    If the credentials reset is successful, the Mobile MUST remember user's name, email, public key, and 
    have access to the procedure that signs an arbitrary message with the matching private key. The Auth MUST 
    bind the new public key to the user and use it further on to validate user's signature. It is RECOMMENDED that
    the Auth deletes a previous public key and only keeps the latest public key.

    \subsection{Unsuccessful credentials reset}
    If the credentials reset fails for any reason related to the protocol, an attempt to reset credentials MUST 
    be discarded. It is RECOMMENDED to log an attempt in order to screen a source of multiple invalid requests. 
    All of the following reasons are considered to be related to the protocol:
        \begin{itemize}
            \item An email is not associated with any account.
            \item Verification code entered into Mobile does not match the expected verification code.
            \item The signature cannot be verified by a given public key.
            \item The signature is invalid.
        \end{itemize}
    If the credentials reset fails for any other reason (e.g. network outage), an appropriate message SHOULD be 
    dispatched or left to other protocols for handling, should they offer such capability.
